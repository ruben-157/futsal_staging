<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>⚽️ ECG Futsal</title>
  <link rel="stylesheet" href="/styles/main.css?v=20250128" />
</head>
<body>
  <header>
    <h1>⚽️ ECG Futsal</h1>
    <div style="display:flex; gap:8px; align-items:center">
      <button class="btn" id="btnAllTimeHeader" type="button" aria-label="Open All-Time leaderboard">
        <svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" style="margin-right:6px; vertical-align:middle">
          <rect x="5" y="10" width="3" height="9" rx="1" stroke="currentColor" stroke-width="2"/>
          <rect x="10.5" y="6" width="3" height="13" rx="1" stroke="currentColor" stroke-width="2"/>
          <rect x="16" y="12" width="3" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
        </svg>
        <span>All-Time Leaderboard</span>
      </button>
      <button class="btn" id="btnAllTimeRefresh" type="button" aria-label="Refresh All-Time leaderboard" hidden>
        <svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" style="margin-right:6px; vertical-align:middle">
          <path d="M21 12a9 9 0 1 1-2.64-6.36" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M21 3v6h-6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Refresh</span>
      </button>
    </div>
  </header>
  <nav class="tabs" role="tablist" aria-label="Futsal sections">
    <button id="tabPlayers" class="tab active" role="tab" aria-selected="true" aria-controls="playersSection">Players</button>
    <button id="tabTeams" class="tab" role="tab" aria-selected="false" aria-controls="teamsSection" disabled>Teams</button>
    <button id="tabMatches" class="tab" role="tab" aria-selected="false" aria-controls="matchesSection">Matches</button>
    <button id="tabLeaderboard" class="tab" role="tab" aria-selected="false" aria-controls="leaderboardSection">Leaderboard</button>
  </nav>
  <main>
    <section id="playersSection" class="picker" role="tabpanel" aria-labelledby="tabPlayers">
      <div id="playersTopBar" style="display:flex; justify-content:flex-end; align-items:center; margin-bottom:8px">
        <button class="btn danger" id="btnResetPlayersTop" type="button" aria-label="Start new match (resets current teams and results)" hidden>Start new match</button>
      </div>
      <div class="panel" aria-labelledby="available-title">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:8px">
          <h2 id="available-title">Available Players</h2>
          <button id="btnAddPlayer" class="btn" type="button" aria-label="Add New Player">Add New Player</button>
        </div>
        <div id="listNot" class="lists" role="list" aria-label="Available players list"></div>
      </div>

      <div id="limitNotice" class="notice" role="status" aria-live="polite" style="display:none">Limit reached: maximum 20 players.</div>
      <div class="actions" id="playersActions">
        <div id="genError" class="notice error" role="alert" style="margin-right:auto; display:none"></div>
        <button class="btn primary" id="btnGenerateBottom" aria-label="Generate balanced teams (bottom)" disabled>Generate Teams</button>
      </div>
    </section>

    <section class="teams" id="teamsSection" role="tabpanel" aria-labelledby="tabTeams" hidden>
      <div style="overflow:auto">
        <table aria-label="Teams table" id="teamsTable">
          <thead>
            <tr>
              <th>Team</th>
              <th>Members</th>
              <th>Size</th>
              <th>Avg Skill</th>
              <th>Avg Stamina</th>
            </tr>
          </thead>
          <tbody id="teamsBody"></tbody>
        </table>
      </div>

    </section>

    <section class="schedule" id="matchesSection" role="tabpanel" aria-labelledby="tabMatches" hidden>
      <div id="matchesList"></div>
    </section>

    <section id="leaderboardSection" role="tabpanel" aria-labelledby="tabLeaderboard" hidden>
      <!-- Leaderboard content rendered by JS -->
    </section>

    <!-- All-Time Leaderboard -->
    <section id="allTimeSection" role="tabpanel" aria-labelledby="btnAllTimeHeader" hidden>
      <div id="allTimeContent" aria-live="polite" role="region" aria-label="All-Time leaderboard content"></div>
    </section>

    
  </main>

  <!-- Modal for setting match results -->
  <div id="overlay" class="modal-overlay" hidden></div>
  <div id="resultModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" hidden>
    <div class="modal-header">
      <h3 id="modalTitle" style="margin:0; font-size:18px">Set Result</h3>
    </div>
    <div class="modal-body">
      <div id="modalMatchLabel" class="notice" style="margin-bottom:8px"></div>
      <div class="modal-fields">
        <label class="score-row">
          <span id="modalTeamAName" style="min-width:120px"></span>
          <div class="score-stepper">
            <button id="modalATeamMinus" class="btn step" type="button" aria-label="Decrease goals">−</button>
            <input id="modalTeamAScore" class="score-input" type="number" inputmode="numeric" min="0" placeholder="0" aria-label="Team A goals" />
            <button id="modalATeamPlus" class="btn step" type="button" aria-label="Increase goals">+</button>
          </div>
        </label>
        <label class="score-row">
          <span id="modalTeamBName" style="min-width:120px"></span>
          <div class="score-stepper">
            <button id="modalBTeamMinus" class="btn step" type="button" aria-label="Decrease goals">−</button>
            <input id="modalTeamBScore" class="score-input" type="number" inputmode="numeric" min="0" placeholder="0" aria-label="Team B goals" />
            <button id="modalBTeamPlus" class="btn step" type="button" aria-label="Increase goals">+</button>
          </div>
        </label>
      </div>
      <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; margin-top:14px; padding-top:10px; border-top:1px solid var(--border)">
        <label class="switch">
          <input id="modalTrackScorers" type="checkbox" aria-label="Track player scorers for this match" />
          <span class="slider"></span>
          <span class="switch-text">Track player scorers for this match</span>
        </label>
        <div id="modalSaveError" class="notice error" style="display:none"></div>
      </div>
      <div id="modalScorers" class="scorers"></div>
    </div>
    <div class="modal-actions">
      <button id="modalCancel" type="button" class="btn">Close</button>
      <button id="modalSave" type="button" class="btn primary" disabled>Save - Match End</button>
    </div>
  </div>

  <!-- Player History Modal -->
  <div id="playerModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="playerModalTitle" hidden>
    <div class="modal-header">
      <h3 id="playerModalTitle" style="margin:0; font-size:18px">Player History</h3>
    </div>
    <div class="modal-body" id="playerModalBody">
      <!-- Filled dynamically -->
    </div>
    <div class="modal-actions">
      <button id="playerModalClose" class="btn" type="button">Close</button>
    </div>
  </div>

  <!-- Modal for adding incidental player -->
  <div id="addPlayerModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="addPlayerTitle" hidden>
    <div class="modal-header">
      <h3 id="addPlayerTitle" style="margin:0; font-size:18px">Add Player</h3>
    </div>
    <div class="modal-body">
      <div class="modal-fields">
        <label style="flex-direction:column; align-items:stretch">
          <span class="notice" style="margin:0 0 6px 0">Enter a name that is not on the roster</span>
          <input id="addPlayerName" class="search" type="text" placeholder="Full name" aria-label="Player name" />
        </label>
        <label style="display:flex; align-items:center; justify-content:space-between; gap:12px">
          <span style="font-size:14px">Skill level (1–5)</span>
          <div class="score-stepper">
            <button id="addPlayerSkillMinus" class="btn mini-step" type="button" aria-label="Decrease skill">−</button>
            <input id="addPlayerSkill" class="scorer-input" type="number" inputmode="numeric" min="1" max="5" step="0.5" value="3" aria-label="Skill level" />
            <button id="addPlayerSkillPlus" class="btn mini-step" type="button" aria-label="Increase skill">+</button>
          </div>
        </label>
        <label style="display:flex; align-items:center; justify-content:space-between; gap:12px">
          <span style="font-size:14px">Stamina level (1–5)</span>
          <div class="score-stepper">
            <button id="addPlayerStaminaMinus" class="btn mini-step" type="button" aria-label="Decrease stamina">−</button>
            <input id="addPlayerStamina" class="scorer-input" type="number" inputmode="numeric" min="1" max="5" step="0.5" value="3" aria-label="Stamina level" />
            <button id="addPlayerStaminaPlus" class="btn mini-step" type="button" aria-label="Increase stamina">+</button>
          </div>
        </label>
        <div id="addPlayerError" class="notice error" style="display:none"></div>
      </div>
    </div>
    <div class="modal-actions">
      <button id="addPlayerCancel" type="button" class="btn">Cancel</button>
      <button id="addPlayerSave" type="button" class="btn primary" disabled>Save</button>
    </div>
  </div>

  <!-- Modal for reset confirmation -->
  <div id="resetModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="resetTitle" hidden>
    <div class="modal-header">
      <h3 id="resetTitle" style="margin:0; font-size:18px">Reset All?</h3>
    </div>
    <div class="modal-body">
      <div class="notice" style="font-weight:600">This clears attendees, teams, results, and rounds.</div>
    </div>
    <div class="modal-actions">
      <button id="resetCancel" type="button" class="btn">Cancel</button>
      <button id="resetConfirm" type="button" class="btn danger">Reset</button>
    </div>
  </div>

  <!-- Modal for choosing team count when n = 11 -->
  <div id="teamCountModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="teamCountTitle" hidden>
    <div class="modal-header">
      <h3 id="teamCountTitle" style="margin:0; font-size:18px">Choose Team Count</h3>
    </div>
    <div class="modal-body">
      <div class="notice" style="font-weight:600; margin-bottom:8px">You have 11 players. Do you want 2 teams or 3 teams?</div>
      <div class="notice">Choose 3 teams to play 4‑4‑3.</div>
    </div>
    <div class="modal-actions">
      <button id="teamCount2" type="button" class="btn">2 Teams</button>
      <button id="teamCount3" type="button" class="btn primary">3 Teams</button>
    </div>
  </div>

  <!-- Modal: Remove Last Round Confirmation -->
  <div id="removeRoundModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="removeRoundTitle" hidden>
    <div class="modal-header">
      <h3 id="removeRoundTitle" style="margin:0; font-size:18px">Remove Round</h3>
    </div>
    <div class="modal-body">
      <div id="removeRoundInfo" class="notice" style="font-weight:600; margin-bottom:8px">Are you sure you want to remove this round?</div>
      <div class="notice">This deletes all matches and results for that round.</div>
    </div>
    <div class="modal-actions">
      <button id="removeRoundCancel" type="button" class="btn">Cancel</button>
      <button id="removeRoundConfirm" type="button" class="btn danger">Remove</button>
    </div>
  </div>

  <!-- End Tournament Confirmation Modal -->
  <div id="endTournamentModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="endTournamentTitle" hidden>
    <div class="modal-header">
      <h3 id="endTournamentTitle" style="margin:0; font-size:18px">End Tournament?</h3>
    </div>
    <div class="modal-body">
      <div id="endTournamentInfo">All matches have been played and all results are in. Do you want to end the tournament or play another round?</div>
    </div>
    <div class="modal-actions">
      <button id="endTournamentAddRound" class="btn" type="button">Add New Round</button>
      <button id="endTournamentYes" class="btn primary" type="button">End Tournament</button>
    </div>
  </div>

  <script type="module" src="/scripts/main.js?v=20250128"></script>
</body>
</html>
